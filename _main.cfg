#textdomain wesnoth-To_Lands_Unknown

[textdomain]
    name="wesnoth-To_Lands_Unknown"
    path="data/add-ons/To_Lands_Unknown/translations"
[/textdomain]

# Prevent conflicts
#undef CAMPAIGN_DESCRIPTION_POEM
#undef CAMPAIGN_DESCRIPTION
#undef TLU_IMAGES_DIR

# Load dependency utils
{~add-ons/To_Lands_Unknown/dependency-utils.cfg}

# Macros for [campaign]
## Macros in ./macros need a #ifdef CAMPAIGN_TO_LANDS_UNKNOWN to work or some macros will fail.
## These macros need to be fixed in the future for 1.19 and later, but it's not a priority.
#define MEDITATION_EVENT
    [event]
        name=side 1 turn end
        id=meditation_event
        first_time_only=no
        [filter_condition]
            [have_unit]
                ability=meditation
            [/have_unit]
        [/filter_condition]

        [store_unit]
            variable=meditation
            [filter]
                ability=meditation
            [/filter]
        [/store_unit]
        #evaluate
        [if]
            {VARIABLE_CONDITIONAL meditation.moves equals $meditation.max_moves}
            [then]
                {VARIABLE_OP meditation.experience add 1}
                [unstore_unit]
                    variable=meditation
                    text=_ "+1 exp"
                    red,green,blue=50,50,200
                [/unstore_unit]
            [/then]
        [/if]
        {CLEAR_VARIABLE meditation}
    [/event]
#enddef

#define MEHIR_AURAS
    [event]
        name=new turn
        first_time_only=no
        id=mehir_auras
        [filter_condition]
            [have_unit]
                type=TLU_Mehir_Leader
            [/have_unit]
        [/filter_condition]
        [store_unit]
            [filter]
                [filter_adjacent]
                    type=TLU_Mehir_Leader
                    is_enemy=yes
                [/filter_adjacent]
                [not]
                    type=TLU_DharmaRashti,TLU_DharmaRashti2,TLU_Rashti,TLU_Rashti2
                [/not]
            [/filter]
            variable=harm2
        [/store_unit]

        [foreach]
            array=harm2
            [do]
                [if]
                    [have_unit]
                        ability=i8slowingaura
                    [/have_unit]
                    [then]
                        {VARIABLE this_item.status.slowed yes}
                        [unstore_unit]
                            find_vacant=no
                            variable=this_item
                        [/unstore_unit]
                    [/then]
                [/if]
                [if]
                    [have_unit]
                        ability=i8damagingaura
                    [/have_unit]
                    [then]
                        {VARIABLE_OP this_item.hitpoints sub 8}
                        [if]
                            [variable]
                                name=this_item.hitpoints
                                less_than_equal_to=0
                            [/variable]
                            [then]
                                [kill]
                                    x,y=$this_item.x,$this_item.y
                                    fire_event=yes
                                    animate=yes
                                [/kill]
                            [/then]
                            [else]
                                [animate_unit]
                                    flag=attack
                                    [filter]
                                        id=Mehir
                                    [/filter]
                                    [primary_attack]
                                        name=incantation of power
                                    [/primary_attack]
                                    hits=no
                                    [facing]
                                        [filter]
                                            x,y=$this_item.x,$this_item.y
                                        [/filter]
                                    [/facing]
                                [/animate_unit]
                                [unstore_unit]
                                    find_vacant=no
                                    variable=this_item
                                    text= _ "8"
                                    {COLOR_HARM}
                                [/unstore_unit]
                            [/else]
                        [/if]
                    [/then]
                [/if]
            [/do]
        [/foreach]
    [/event]
#enddef

# wmlindent: start ignoring
#define TLU_IMAGES_DIR
data/add-ons/To_Lands_Unknown_Resources_1/images#enddef
# wmlindent: stop ignoring

#define CAMPAIGN_DESCRIPTION_POEM
    +"
"+_"<i>Hearken ye,
You strangers in a desolate land
To this tale of lands most old,
of the Summoners of al-Kamija,
Those mighty magi
Of powers untold,
Their Abysmal servants
Both good and bad,
And of Mehir, who had,
As once foretold,
saved all life in this world.</i>"+
#enddef

#define CAMPAIGN_DESCRIPTION
        "
"+_"
This is the story of Mehir, the Summoner, and his journey to lands unknown."+"
"+_"
(Intermediate or Expert level. 19 playable scenarios.)"+
#enddef

        # wmlscope: set export=no
    [campaign]
        id="To_Lands_Unknown"
        rank=400
        icon="{TLU_IMAGES_DIR}/campaign-menu-interface/summoners-logo.png"
        name= _ "To Lands Unknown"
        abbrev= _ "TLU"
        background="data/add-ons/To_Lands_Unknown_Resources_2/images/story/alkamija_02.jpg"
        define=CAMPAIGN_TO_LANDS_UNKNOWN
        first_scenario="00_Prologue"

        {CAMPAIGN_DIFFICULTY EASY   "{TLU_IMAGES_DIR}/campaign-menu-interface/easy.png~RC(magenta>red)" ( _ "Jinni") ( _ "Easy")}
        {CAMPAIGN_DIFFICULTY NORMAL "{TLU_IMAGES_DIR}/campaign-menu-interface/medium.png~RC(magenta>red)" ( _ "Wonderful Jinni") ( _ "Normal")} {DEFAULT_DIFFICULTY}
        {CAMPAIGN_DIFFICULTY HARD   "{TLU_IMAGES_DIR}/campaign-menu-interface/hard.png~RC(magenta>red)" ( _ "Mystical Jinni") ( _ "Hard")}

        description="<span color='#BCB088' size='large'>"+ _"To Lands Unknown"+"</span>"+{CAMPAIGN_DESCRIPTION_POEM}{CAMPAIGN_DESCRIPTION}{HAVE_ERA_OF_MAGIC_STATUS}{TLU_HAVE_IMAGES_STATUS}

        image="{TLU_IMAGES_DIR}/campaign-menu-interface/campaign-image.png"

        [about]
        [/about]
        {./about.cfg}
        {MEDITATION_EVENT}
        {MEHIR_AURAS}
    [/campaign]

#ifdef CAMPAIGN_TO_LANDS_UNKNOWN

#define TLU_KEEP_IDS
    TLU_DharmaRashti,TLU_DharmaRashti2,TLU_HoRashti,TLU_HoRashti2,TLU_The_Last_Summoner,TLU_Rashti,TLU_Rashti2,TLU_True_Rashti,TLU_Elder#enddef

    {~add-ons/Era_of_Magic/campaign.cfg}
    {~add-ons/To_Lands_Unknown/macros}
    {~add-ons/To_Lands_Unknown/lua}
    [+units]
        {~add-ons/To_Lands_Unknown/units/}
        {EOMA_STANDARD_HIDING_CODE_WITH_ADDITIONS {TLU_KEEP_IDS} ()}
    [/units]
    {~add-ons/To_Lands_Unknown/scenarios}
    [binary_path]
        path=data/add-ons/To_Lands_Unknown
    [/binary_path]

#ifdef TLU_HAVE_IMAGES
    [binary_path]
        path=data/add-ons/To_Lands_Unknown_Resources_1
    [/binary_path]
    [binary_path]
        path=data/add-ons/To_Lands_Unknown_Resources_2
    [/binary_path]
#endif
#endif
#ifdef EDITOR
    {~add-ons/To_Lands_Unknown/macros/terrain_base.cfg}
    [binary_path]
        path=data/add-ons/To_Lands_Unknown
    [/binary_path]

#ifdef TLU_HAVE_IMAGES
    [binary_path]
        path=data/add-ons/To_Lands_Unknown_Resources_1
    [/binary_path]
    [binary_path]
        path=data/add-ons/To_Lands_Unknown_Resources_2
    [/binary_path]
#endif
#endif

    # Clean up
#undef HAVE_ERA_OF_MAGIC
#undef HAVE_ERA_OF_MAGIC_STATUS
#undef TLU_HAVE_IMAGES
#undef TLU_HAVE_IMAGES_STATUS
#undef TLU_IMAGES_DIR
#undef CAMPAIGN_DESCRIPTION_POEM
#undef CAMPAIGN_DESCRIPTION
