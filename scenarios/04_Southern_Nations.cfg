#textdomain wesnoth-To_Lands_Unknown
#define GIFT_MESSAGE
    [message]
        speaker=Mehir
        message= _ "Uhh... Hello? Who are you?"
    [/message]
    [message]
        speaker=messenger
        message= _ "Ssstranger, Rhaxizzzz hassss ssssent me to thank you for your aid."
    [/message]
    [message]
        speaker=Mehir
        message= _ "Heh, glad to see that my help hasn't went unnoticed..."
    [/message]
    [delay]
        time=500
    [/delay]
    [message]
        speaker=Mehir
        image=portraits/mehir-shocked.png
        message= _ "Wait, you can speak our language?!"
    [/message]
    [message]
        speaker=messenger
        message= _ "There iss no time for exssplanationss. Rhaxiz ordered me to find a way to sssupport you, so I ssstole this chest from your master's tent."
    [/message]
    [message]
        speaker=Mehir
        image=portraits/mehir-shocked.png
        message= _ "Good Nomolas! This is Jaffar's chest! How..."
    [/message]
    [message]
        speaker=messenger
        message= _ "Hisss power is inssside. I am sure you will ussse it in a better way than he doesss. Take it."
    [/message]
    [redraw]
    [/redraw]
    [message]
        speaker=Mehir
        message= _ "(takes a look at the gold inside) Holy vizier! This is a quarter of the Sud-Affar's entire military budget! My goodness..."
    [/message]
    [message]
        speaker=messenger
        message= _ "On top of that, I found thessse two demonsss' cansss. I'm sssure they can prove ussseful to you."
    [/message]
    [message]
        speaker=Mehir
        message= _ "These are the lamps with the Efreeti Jaffar threatened me with! My, my... you certainly don't seem to stop impressing me."
    [/message]
    [message]
        speaker=messenger
        message= _ "However, I alssso have some bad news: our sssscouts report flying enemy reinforcements coming from the northwessst. They should arrrrive sssoon, so better sstay alert."
    [/message]
    [message]
        speaker=messenger
        message= _ "I mussst return to Rhaxiz. Take care, and know that we're grateful for what you're doing."
    [/message]
    [message]
        speaker=Mehir
        message= _ "Huh? Leaving already? But I have so many questions to ask..."
    [/message]
    [kill]
        id=messenger
        animate=yes
    [/kill]
    [gold]
        side=1
        amount=750
    [/gold]
    [message]
        speaker=Mehir
        message= _ "He's gone... These creatures are more and more surprising by the moment."
    [/message]
    [message]
        speaker=narrator
        image=portraits/narrator.png
        message= _ "Received 750 gold, as well as two Efreet lamps!"
    [/message]
    [message]
        speaker=Mehir
        message= _ "With so much gold I could literally buy Sud-Affar's entire army! And these lamps..."
    [/message]
    {UNIT 1 (EoMa_Efreet) 19 8 (generate_name=yes
    random_traits=yes)}
    {UNIT 1 (EoMa_Efreet) 19 8 (generate_name=yes
    random_traits=yes)}
    [message]
        type=EoMa_Efreet
        message= _ "At last! Who shall I torture, my master?"
    [/message]
    [message]
        speaker=Mehir
        message= _ "Take out your anger on those barbarians. And now..."
    [/message]
    {MOVE_UNIT id=Mehir 22 7}
    [message]
        speaker=Mehir
        message= _ "*ahem* Soldiers! Join me against the barbarians, and I will pay you twice as much as Jaffar does!"
    [/message]
    {MOVE_UNIT id=Jaffar 25 6}
    [message]
        speaker=Jaffar
        image=portraits/jaffar-angry.png
        message= _ "Hey, it's my g..."
    [/message]
    [sound]
        name=bow.ogg
    [/sound]
    [message]
        speaker=Jaffar
        message= _ "...oh... a soporific arrow..."
    [/message]
    {TRANSFER_VILLAGE_OWNERSHIP 4 1}
    [kill]
        id=Jaffar
        animate=no
    [/kill]
    {UNIT 4 (TLU_Jaffar) 25 6 (name=_"Jaffar"
    {IS_HERO}
    id=Jaffar
    placement,overwrite=map,yes)}
    {MOVE_UNIT x,y=22,1 22 6}
    {MOVE_UNIT x,y=30,3 24 7}
    {MOVE_UNIT x,y=26,5 23 7}
    {MODIFY_UNIT (type=EoMa_Heavy_Summoner,EoMa_Summoner) side 1}
    [message]
        x,y=23,7
        message= _ "Finally, a commander with initiative! You can count on us, but not on those magical guardians. They only obey Jaffar, after all."
    [/message]
    [message]
        speaker=Mehir
        message= _ "It's no big deal. I've got your support, and I have his Efreet. Let's help those lizards!"
    [/message]
    {MOVE_UNIT id=Mehir 27 5}
    [message]
        speaker=narrator
        image=portraits/narrator.png
        message= _ "Remember: Jaffar's Efreet will aid you only in this battle. Then they will leave you and return to their owner (if they survive the engagement of course)."
    [/message]
    [message]
        speaker=narrator
        image=portraits/narrator.png
        message= _ "Tip: You can use the Heavy Summoner’s summon ability to create new units. Right-click on him for details.

(All lvl3 Summoners have this ability)"
    [/message]
    [objectives]
        side=1
        [objective]
            description= _ "Kill Brogh’ur"
            condition=win
        [/objective]
        [objective]
            description= _ "Death of Rhaxiz"
            condition=lose
        [/objective]
        [objective]
            description= _ "Death of Mehir"
            condition=lose
        [/objective]
        {TURNS_RUN_OUT}
        [gold_carryover]
            bonus=no
            carryover_percentage=10
        [/gold_carryover]
        note= _ "Although you are given a lot of gold, you won't get to use most of it in the following scenario (the gold carryover is only 10%)"
    [/objectives]
    {VARIABLE gift 1}
#enddef
[scenario]
    id=04_Southern_Nations
    next_scenario=05_Jungle_of_Life

    name= _ "Southern Nations"
    map_data="{~add-ons/To_Lands_Unknown/maps/04_Southern_Nations.map}"
    turns=44
    victory_when_enemies_defeated=no

    {DEFAULT_SCHEDULE}

    {SCENARIO_MUSIC dark_passage.ogg}

    {STORYTXT_SOUTHERN_NATIONS}

    [side]
        side=1
        controller=human
        team_name=mehirteam
        user_team_name= _ "team_name^Mehir"
        shroud=yes
        share_maps=yes

        type=TLU_Mehir_Guard
        id=Mehir
        name= _ "Mehir"
        unrenamable=yes
        canrecruit=yes
        profile=portraits/mehir.png

        recruit=EoMa_Novice_Summoner,EoMa_Camel_Rider,EoMa_Carpet_Rider

        {GOLD 200 150 100}
        {INCOME 10 7 4}
    [/side]

    [side]
        side=2
        controller=ai
        team_name=darkblood
        user_team_name= _ "team_name^Lizards"

        type=EoMa_Mystical_Toad
        id=Rhaxiz
        name= _ "Rhaxiz"
        profile=portraits/darkblood/mystic.png
        image_icon=portraits/darkblood/mystic.png~CROP(120,90,130,130)~SCALE(72,72)
        unrenamable=yes
        canrecruit=yes
        facing=sw

        recruit=EoMa_Toad,EoMa_Saurian_Pikeman,EoMa_Shamanistic_Adept,EoMa_Saurian_Shooter,EoMa_Wyvern,EoMa_Wyvern_Rider,EoMa_Salamander

        {GOLD 0 0 0}
        {INCOME 12 10 7}

        [ai]
            [goal]
                name=protect_unit
                [criteria]
                    id=Rhaxiz
                [/criteria]
                value=20
                protect_radius=7
            [/goal]
            simple_targeting=yes
            caution=0.5
            #make Rhaxiz' forces attack barbarians only
            [aspect]
                id=attacks
                [facet]
                    invalidate_on_gamestate_change=yes
                    [filter_own]
                        side=2
                    [/filter_own]
                    [filter_enemy]
                        side=3
                    [/filter_enemy]
                [/facet]
            [/aspect]
        [/ai]

        {UNIT 2 EoMa_Jungle_Guardian 17 16 (facing=sw
        generate_name=yes
        hitpoints=34
        experience=22
        random_traits=yes)}
        {UNIT 2 EoMa_Jungle_Guardian 16 17 (facing=sw
        generate_name=yes
        hitpoints=42
        experience=2
        random_traits=yes)}
        {UNIT 2 EoMa_Jungle_Guardian 18 17 (facing=sw
        generate_name=yes
        random_traits=yes)}
        {UNIT 2 EoMa_Saurian_Pikeman 20 15 (facing=sw
        generate_name=yes
        hitpoints=21
        experience=13
        random_traits=yes)}
        {UNIT 2 EoMa_Jungle_Guardian 15 15 (facing=sw
        generate_name=yes
        random_traits=yes)}
        {UNIT 2 EoMa_Saurian_Shooter 22 14 (facing=sw
        generate_name=yes
        hitpoints=24
        experience=15
        random_traits=yes)}
        {UNIT 2 EoMa_Saurian_Shooter 11 16 (facing=sw
        generate_name=yes
        experience=5
        random_traits=yes)}
        {UNIT 2 EoMa_Shamanistic_Adept 13 18 (facing=sw
        generate_name=yes
        random_traits=yes)}
        {UNIT 2 EoMa_Salamander 21 18 (facing=sw
        generate_name=yes
        hitpoints=22
        experience=20
        random_traits=yes)}
        {UNIT 2 EoMa_Great_Wyvern 16 19 (facing=sw
        generate_name=yes
        random_traits=yes)}
        {UNIT 2 EoMa_Wyvern 19 15 (facing=sw
        generate_name=yes
        random_traits=yes)}
        {UNIT 2 EoMa_Saurian_Shooter 18 14 (facing=sw
        generate_name=yes
        hitpoints=12
        experience=4
        random_traits=yes)}
        {UNIT 2 EoMa_Corrupted_Shaman 14 16 (facing=sw
        generate_name=yes
        experience=16
        random_traits=yes)}
        {UNIT 2 EoMa_Salamander 19 20 (facing=sw
        generate_name=yes
        random_traits=yes)}
        {UNIT 2 EoMa_Shamanistic_Adept 10 20 (facing=sw
        generate_name=yes
        random_traits=yes)}
        {UNIT 2 EoMa_Saurian_Crossbowman 9 19 (facing=sw
        generate_name=yes
        random_traits=yes)}

        {UNIT 2 EoMa_Corrupted_Shaman 14 16 (facing=sw
        generate_name=yes
        random_traits=yes)}
        {UNIT 2 EoMa_Toad 14 18 (facing=sw
        generate_name=yes
        hitpoints=42
        experience=20
        random_traits=yes)}
        {UNIT 2 EoMa_Yellow_Salamander 18 19 (facing=sw
        generate_name=yes
        random_traits=yes)}
        {UNIT 2 EoMa_Shamanistic_Adept 10 20 (facing=sw
        generate_name=yes
        random_traits=yes)}
        {UNIT 2 EoMa_Saurian_Crossbowman 9 19 (facing=sw
        generate_name=yes
        experience=12
        random_traits=yes)}
        {UNIT 2 EoMa_Saurian_Crossbowman 29 20 (facing=sw
        generate_name=yes
        hitpoints=30
        experience=4
        random_traits=yes)}
        {UNIT 2 EoMa_Saurian_Crossbowman 29 20 (facing=sw
        generate_name=yes
        random_traits=yes)}
        {UNIT 2 EoMa_Salamander 29 20 (facing=sw
        generate_name=yes
        random_traits=yes)}
    [/side]

    [side]
        side=3
        controller=ai
        team_name=barbarians
        user_team_name= _ "team_name^Barbarians"
        color=orange
        {FLAG_VARIANT6 ragged}

        type=EoMa_Barbarian_Lord
        id=Broghur
        name= _ "Brogh’ur"
        unrenamable=yes
        canrecruit=yes
        image_icon=portraits/barbarians/barbarian-lord.png~CROP(150,40,130,130)~SCALE(72,72)

        recruit=EoMa_Cyclops,EoMa_Goblin_Archer,EoMa_Goblin_Hunter,EoMa_Goblin_Kamikaze,EoMa_Goblin_Runt,EoMa_Goblin_Warbanner,EoMa_Barbarian_Berserker,EoMa_Troll_Sorcerer,EoMa_Orcish_Warrior

        [ai]
            aggression=1.0
            simple_targeting=yes
        [/ai]
        {GOLD 90 170 230}
        {INCOME 3 7 10}
        {UNIT 3 (EoMa_Orcish_Warrior) 19 15 (generate_name=yes
        hitpoints=34
        experience=25
        random_traits=yes)}
        {UNIT 3 (EoMa_Troll_Sorcerer) 19 15 (generate_name=yes
        hitpoints=32
        experience=23
        random_traits=yes)}
        {UNIT 3 (EoMa_Goblin_Veteran) 18 14 (generate_name=yes
        hitpoints=35
        experience=5
        random_traits=yes)}
        {UNIT 3 (EoMa_Goblin_Warbanner) 20 14 (generate_name=yes
        random_traits=yes)}
        {UNIT 3 (EoMa_Orcish_Warrior) 14 16 (generate_name=yes
        random_traits=yes)}
        {UNIT 3 (EoMa_Cyclops) 14 18 (generate_name=yes
        random_traits=yes
        hitpoints=30
        experience=2)}
        {UNIT 3 (EoMa_Goblin_Hunter) 19 20 (generate_name=yes
        random_traits=yes)}
        {UNIT 3 (EoMa_Troll_Sorcerer) 10 20 (generate_name=yes
        random_traits=yes)}
        {UNIT 3 (EoMa_Cyclops_Goliath) 8 19 (id=Krog
        name= _ "Krog"
        random_traits=yes
        facing=ne
        image_icon="portraits/barbarians/cyclopsgoliath.png~CROP(225,0,140,140)~SCALE(72,72)")}
        {UNIT 3 (EoMa_Goblin_Kamikaze) 8 19 (generate_name=yes
        random_traits=yes)}
        {UNIT 3 (EoMa_Goblin_Kamikaze) 8 19 (generate_name=yes
        random_traits=yes)}
        {UNIT 3 (EoMa_Goblin_Kamikaze) 8 19 (generate_name=yes
        random_traits=yes)}
        {UNIT 3 (EoMa_Goblin_Kamikaze) 8 19 (generate_name=yes
        random_traits=yes)}
        {UNIT 3 (EoMa_Cyclops) 8 19 (generate_name=yes
        random_traits=yes)}
        {UNIT 3 (EoMa_Cyclops) 8 19 (generate_name=yes
        random_traits=yes)}
        {UNIT 3 (EoMa_Cyclops) 20 15 (generate_name=yes
        random_traits=yes)}
        {UNIT 3 (EoMa_Orcish_Warbanner) 15 15 (generate_name=yes
        random_traits=yes)}
        {UNIT 3 (EoMa_Goblin_Runt) 20 14 (generate_name=yes
        random_traits=yes)}

        {UNIT 3 (EoMa_Troll_Sorcerer) 23 14 (generate_name=yes
        random_traits=yes)}
        {UNIT 3 (EoMa_Goblin_Sniper) 11 16 (generate_name=yes
        random_traits=yes)}
        {UNIT 3 (EoMa_Cyclops) 13 18 (generate_name=yes
        random_traits=yes)}
        {UNIT 3 (EoMa_Orcish_Warrior) 21 18 (generate_name=yes
        random_traits=yes)}
        {UNIT 3 (EoMa_Fire_Cyclops) 16 19 (generate_name=yes
        random_traits=yes)}

        {UNIT 3 (EoMa_Cyclops) 8 19 (generate_name=yes
        random_traits=yes)}
        {UNIT 3 (EoMa_Cyclops) 8 19 (generate_name=yes
        random_traits=yes)}
        {UNIT 3 (EoMa_Cyclops) 20 15 (generate_name=yes
        random_traits=yes)}
        {UNIT 3 (EoMa_Orcish_Warbanner) 15 15 (generate_name=yes
        random_traits=yes)}
        {UNIT 3 (EoMa_Goblin_Runt) 20 14 (generate_name=yes
        random_traits=yes)}

        {UNIT 3 (EoMa_Troll_Sorcerer) 22 14 (generate_name=yes
        random_traits=yes)}
        {UNIT 3 (EoMa_Goblin_Sniper) 11 16 (generate_name=yes
        random_traits=yes)}
        {UNIT 3 (EoMa_Cyclops) 13 18 (generate_name=yes
        random_traits=yes)}
        {UNIT 3 (EoMa_Orcish_Warrior) 21 18 (generate_name=yes
        random_traits=yes)}

        {UNIT 3 (EoMa_Barbarian) 13 18 (facing=sw
        generate_name=yes
        random_traits=yes)}
        {UNIT 3 (EoMa_Barbarian) 21 18 (facing=sw
        generate_name=yes
        random_traits=yes)}
    [/side]

    [side]
        side=4
        controller=ai
        team_name=mehirteam,darkblood,barbarians
        user_team_name= _ "team_name^Army of Sud-Affar"
        shroud=yes
        share_maps=yes
        color=green

        type=EoMa_Grand_Summoner
        id=Jaffar
        name= _ "Jaffar"
        profile=portraits/jaffar.png
        image_icon=portraits/jaffar.png~CROP(150,60,130,130)~SCALE(72,72)
        unrenamable=yes
        canrecruit=yes

        recruit=EoMa_Novice_Summoner,EoMa_Summoner,EoMa_Heavy_Camel_Rider,EoMa_Carpet_Rider,EoMa_Water_Elemental,EoMa_Earth_Elemental,EoMa_Dispeller

        {GOLD 0 0 0}
        {INCOME 0 0 0}

        [ai]
            [leader_goal]
                x,y=27,6
            [/leader_goal]
            [avoid]
                x=21,22,23
                y=7,7,8
            [/avoid]
        [/ai]

        {UNIT 4 (EoMa_Summoner) 22 1 (generate_name=yes
        random_traits=yes)}
        {UNIT 4 (EoMa_HoRhami) 34 2 (generate_name=yes
        random_traits=yes)}
        {UNIT 4 (EoMa_Great_Jinn) 32 3 (generate_name=yes
        random_traits=yes)}
        {UNIT 4 (EoMa_Heavy_Summoner) 30 3 (generate_name=yes
        random_traits=yes)}
        {UNIT 4 (EoMa_Summoner) 26 5 (generate_name=yes
        random_traits=yes)}
        {UNIT 4 (EoMa_Wonderful_Jinn) 36 1 (generate_name=yes
        random_traits=yes)}
    [/side]

    #prestart
    [event]
        name=prestart
        {CAPTURE_VILLAGES 2 30 25 8}
        {CAPTURE_VILLAGES 3 2 21 6}
        {CAPTURE_VILLAGES 4 25 3 8}
        {VARIABLE gift 0}
        {TELEPORT_UNIT id=Mehir 24 2}
        {TELEPORT_UNIT id=Jaffar 23 2}
        {MODIFY_UNIT id=Mehir facing sw}
        {MODIFY_UNIT id=Jaffar facing sw}
        {MODIFY_UNIT side=4 status.guardian yes}

        [object]
            silent=yes
            duration=forever
            [filter]
                id=Krog
            [/filter]
            [effect]
                apply_to=new_animation
                [animation]
                    apply_to=krog

                    [frame]
                        image="units/barbarians-cyclops/goliath-se[1~5].png:150"
                        offset=0~0.6:250,0.6~0:250
                    [/frame]
                    [frame]
                        image="units/barbarians-cyclops/goliath.png:2000"
                        offset=0.0
                    [/frame]
                    [victim_frame]
                        image="units/darkblood-saurians/crossbowman.png:250"
                        image_mod=~RC(magenta>green)
                        offset=1.0
                    [/victim_frame]
                    [victim_frame]
                        image="units/krog-victim.png:3000"
                        image_mod=~RC(magenta>green)
                        offset=1.0~3.0
                        directional_y=0~-800
                    [/victim_frame]
                    sound_start_time=250
                    [sound_frame]
                        sound=explosion.ogg
                    [/sound_frame]
                [/animation]
            [/effect]
        [/object]
    [/event]

    #start
    [event]
        name=start

        {PLACE_IMAGE items/burial.png 7 24}
        {PLACE_IMAGE items/burial.png 5 20}
        [item]
            x,y=26,1
            halo="units/worker[1,2,3,2].png:200"
        [/item]
        [item]
            x,y=26,2
            halo="units/worker[1,2,3,2].png:100"
        [/item]
        [item]
            x,y=27,3
            halo="units/worker[1,2,3,2].png:200"
        [/item]
        [item]
            x,y=28,3
            halo="units/worker[1,2,3,2].png:100"
        [/item]

        [message]
            speaker=Mehir
            message= _ "This place seems quiet, suspiciously quiet..."
        [/message]
        [message]
            speaker=Jaffar
            message= _ "Yeah, those beasts should’ve eaten us a long time ago. We've been sitting in this jungle for a week, and there's not been a trace of them!"
        [/message]
        [message]
            speaker=Mehir
            message= _ "Either they don't want to mess with a large army, or have more pressing matters at hand. I think it might be both..."
        [/message]
        {BADASS_MODE_CHANGE (
            [message]
                speaker=Jaffar
                message= _ "Soon, we'll finally reach the end of this damn jungle. As long as the lizards don't change their mind about steering clear of us, we should be able to connect the circle with Sud-Affar’s portal in four months. It would be a hell of a lot easier if our fire elementals had not been weakened by the wet tropical climate, though."
            [/message]
        ) (
            [message]
                speaker=Jaffar
                message= _ "Soon, we'll finally reach the end of this damn jungle. As long as the lizards don't change their mind about steering clear of us, we should be able to connect the circle with Sud-Affar’s portal in four months. We could’ve done the same in just a couple of months, if only this stupid ban on Fire Elementals wasn’t in force..."
            [/message]
            [message]
                speaker=Mehir
                message= _ "Please understand. Using Fire Elementals may cause those beasts to reappear. We shouldn’t tempt fate."
            [/message]
            [message]
                speaker=Jaffar
                message= _ "If there are any. If not..."
            [/message]
        )}

        [delay]
            time=500
        [/delay]

        {ANIMHACK lizardfall-ground 23 5 ne}

        [delay]
            time=500
        [/delay]

        [message]
            speaker=Mehir
            image=portraits/mehir-shocked.png
            message= _ "What the..."
        [/message]

        {ANIMHACK lizardfall 19 3 ne}

        [message]
            speaker=Jaffar
            image=portraits/jaffar-shocked.png
            message= _ "They are... lizards. Lizards falling from the sky!"
        [/message]

        {ANIMHACK lizardfall 22 3 ne}

        [message]
            speaker=Jaffar
            image=portraits/jaffar-shocked.png
            message= _ "Dear Nomolas... So the doctors were right, I am completely insane!"
        [/message]
        [message]
            speaker=Mehir
            image=portraits/mehir-shocked.png
            message= _ "My liege! I am seeing this too!"
        [/message]
        [message]
            speaker=Jaffar
            image=portraits/jaffar-shocked.png
            message= _ "This place is cursed! We must burn it to the ground! Where are my Efreet?!"
        [/message]
        [message]
            speaker=Mehir
            image=portraits/mehir-shocked.png
            message= _ "Wait! Are you hearing this?"
        [/message]
        [message]
            speaker=Jaffar
            message= _ "You mean voices? Well... sometimes..."
        [/message]
        [message]
            speaker=Mehir
            message= _ "Err, no. I just heard noise coming from the south. We should probably have a look..."
        [/message]

        [remove_shroud]
            side=1
            x,y=22,7
            radius=3
        [/remove_shroud]
        {MOVE_UNIT id=Mehir 22 7}
        {MOVE_UNIT id=Jaffar 23 7}
        [message]
            speaker=Mehir
            message= _ "Oh my..."
        [/message]
        [remove_shroud]
            side=1
            x,y=22,7
            radius=40
        [/remove_shroud]

        {TLU_SMOOTH_REPLACE_MUSIC legends_of_the_north.ogg 1000 0}

        [message]
            speaker=Krog
            message= _ "KROG FEEL POWER! KROG WANT CRUSH, DESTROY, BREAK!!!"
        [/message]
        [delay]
            time=200
        [/delay]
        [kill]
            x,y=9,19
            animate=no
        [/kill]
        [animate_unit]
            flag=krog
            [filter]
                id=Krog
            [/filter]
        [/animate_unit]

        [message]
            speaker=Rhaxiz
            message= _ "Hiiiilafaiiii!"
        [/message]
        [message]
            speaker=Broghur
            message= _ "Kill those damned lizards! Leave none alive! Whoever brings me their leader's crushed skull will get half a giant toad worth of meat, and two barrels of booze!"
        [/message]

        [message]
            speaker=Jaffar
            image=portraits/jaffar-shocked.png
            message= _ "So I'm not hallucinating, all of this is real, right? What the hell kind of place did we get ourselves into?!..."
        [/message]
        {BADASS_MODE_CHANGE (
            [message]
                speaker=Mehir
                message= _ "Whoever they are, I'd rather not mess with them. It would be wiser to stay here and protect the construction site, my liege. This is not our war."
            [/message]
            [message]
                speaker=Jaffar
                image=portraits/jaffar.png
                message= _ "Indeed. You keep a keen eye on the natives, and immediately alert me should they dare approach us!"
            [/message]
            [message]
                speaker=Mehir
                message= _ "Sir! Yes, sir!"
            [/message]
            {MOVE_UNIT id=Jaffar 27 6}
            {MODIFY_TERRAIN Dd^Vdt 20 7}
            {MODIFY_TERRAIN Ce (21,22,23) (7,7,8)}
            {MODIFY_TERRAIN Ke 22 7}
            [capture_village]
                side=1
                x,y=20,7
            [/capture_village]
            [modify_side]
                side=2
                [ai]
                    leader_ignores_keep=yes
                [/ai]
            [/modify_side]
            [message]
                speaker=narrator
                image=portraits/narrator.png
                message= _ "The upcoming battle is going to take place without your interference for now."
            [/message]
            [place_shroud]
                side=1
                x,y=22,7
                radius=40
            [/place_shroud]
            {FADE_TO_BLACK}
            [hide_unit]
                side=1,4
            [/hide_unit]
        ) (
            [message]
                speaker=Mehir
                message= _ "Your guess is as good as mine. Anyway, look, I know this might sound ridiculous, but we should help those lizards!"
            [/message]
            [message]
                speaker=Jaffar
                image=portraits/jaffar-angry.png
                message= _ "Have you lost your mind?! Those sneaky, beastly greenlings are surely invading the land of that brute! If at all, we should help that one-eyed tree-wielder! But this is not our war. They are busy with each other, the circle is safe - what more could one want?"
            [/message]
            [message]
                speaker=Mehir
                message= _ "But don’t you see that if we help the lizards, can win ourselves quite an ally? The circle crosses their territory, and as far as I know we are quite unwelcome here. This is the chance to change that."
            [/message]
            [message]
                speaker=Jaffar
                image=portraits/jaffar-angry.png
                message= _ "Are you kidding me? They’d rather tear you apart than come to an understanding. My task here is to protect the circle, which means I can't allow any natives near it. If you want to support them, you may, but don't expect me to do as much as lift a finger to help you. And for the love of Nomolas keep those savages away from the construction site, or my Efreet will have a word with you."
            [/message]
            [message]
                speaker=Mehir
                message= _ "I will fight with my own men. Wish me luck, Jaffar."
            [/message]
            [message]
                speaker=Jaffar
                message= _ "You'll certainly need a lot of it to make this absurd plan work..."
            [/message]
            {MOVE_UNIT id=Mehir 19 8}
            {MODIFY_TERRAIN Ke 19 8}
            {MODIFY_TERRAIN Dd^Vdt 20 7}
            {MODIFY_TERRAIN Ce (18,19,20) (8,9,8)}
            [capture_village]
                side=1
                x,y=20,7
            [/capture_village]
            [message]
                speaker=Mehir
                message= _ "I must win these lizards over. The most reasonable starting point would be to kill a few barbarians, to display that we're on the lizards' side. Do not attack the lizards, otherwise the plan will completely fail!"
            [/message]

            [message]
                speaker=narrator
                image=portraits/narrator.png
                message= _ "If you find the upcoming battle too slow, you can increase game speed via settings."
            [/message]

            {VARIABLE bcounter 0}

            [objectives]
                side=1
                [objective]
                    description= _ "Kill some barbarians"
                    condition=win
                [/objective]
                [objective]
                    description= _ "Protect lizards"
                    condition=win
                [/objective]
                [objective]
                    description= _ "Death of Mehir"
                    condition=lose
                [/objective]
                [objective]
                    description= _ "Death of Rhaxiz"
                    condition=lose
                [/objective]
                [objective]
                    description= _ "Killing any lizard"
                    condition=lose
                [/objective]
                [objective]
                    description= _ "Recruiting a Fire Elemental or its advancements"
                    condition=lose
                [/objective]
                {TURNS_RUN_OUT}
                [gold_carryover]
                    bonus=no
                    carryover_percentage=10
                [/gold_carryover]
            [/objectives]
        )}
    [/event]

    #killing a lizard = game over
    #TODO: make this more flexible - if a lizard is killed by Mehir's troops (even accidentally) continue with lizards being hostile
    [event]
        name=die
        [filter]
            side=2
        [/filter]
        [filter_second]
            side=1
        [/filter_second]

        {BADASS_MODE_CHANGE () (
            [endlevel]
                result=defeat
            [/endlevel]
        )}
    [/event]

    #recruiting Fire Elementals = game over
    [event]
        name=recall, post summon
        [filter]
            type=EoMa_Fire_Elemental,EoMa_Fire_Avatar,EoMa_Fire_God
        [/filter]

        {BADASS_MODE_CHANGE () (
            [endlevel]
                result=defeat
            [/endlevel]
        )}
    [/event]

    #skipping turns for badass mode:
    [event]
        name=side 1 turn
        first_time_only=no

        {IF_VAR spotted not_equals yes (
            [then]
                {BADASS_MODE_CHANGE (
                    [print]
                        text= _ "Please wait..."
                        duration=300
                        size=24
                        color=0,128,256
                    [/print]
                    [end_turn]
                    [/end_turn]
                ) ()}
            [/then]
        )}
    [/event]

    #successfully killed 2 Barbarians
    [event]
        name=die
        first_time_only=no
        [filter]
            side=3
        [/filter]
        [filter_second]
            side=1
        [/filter_second]

        {BADASS_MODE_CHANGE () (
            {VARIABLE_OP bcounter add 1}

            [if]
                [variable]
                    name=bcounter
                    equals=2
                [/variable]
                [then]
                    [message]
                        speaker=Rhaxiz
                        message= _ "Khaal siftu nax. Rav!"
                    [/message]

                    [modify_side]
                        side=2
                        team_name=mehirteam
                    [/modify_side]

                    [message]
                        speaker=Mehir
                        image=portraits/mehir-happy.png
                        message= _ "Hey, the plan seems to be working! Now time to strike against the barbarians with our combined forces!"
                    [/message]
                    [message]
                        speaker=Rhaxiz
                        message= _ "(series of gestures demanding retreat)"
                    [/message]
                    [message]
                        speaker=Mehir
                        message= _ "So you want to withdraw? But where?"
                    [/message]
                    [message]
                        speaker=Rhaxiz
                        message= _ "(points his finger towards a keep inside the jungle)"
                    [/message]
                    {SCROLL_TO 34 21}
                    [delay]
                        time=1500
                    [/delay]
                    [message]
                        speaker=Mehir
                        message= _ "Understood. (to his men) Protect the lizard leader at all costs!"
                    [/message]

                    [modify_side]
                        side=2
                        [ai]
                            [leader_goal]
                                x,y=34,21
                            [/leader_goal]
                            [goal]
                                name=protect_unit
                                [criteria]
                                    id=Rhaxiz
                                [/criteria]
                                protect_radius=10
                                value=100
                            [/goal]
                        [/ai]
                    [/modify_side]
                    [modify_side]
                        side=3
                        [ai]
                            [goal]
                                [criteria]
                                    id=Rhaxiz
                                [/criteria]
                                value=100
                            [/goal]
                        [/ai]
                    [/modify_side]

                    [objectives]
                        side=1
                        [objective]
                            description= _ "Rhaxiz reaches the southeast keep"
                            condition=win
                        [/objective]
                        [objective]
                            description= _ "Death of Rhaxiz"
                            condition=lose
                        [/objective]
                        [objective]
                            description= _ "Death of Mehir"
                            condition=lose
                        [/objective]
                        {TURNS_RUN_OUT}
                        [gold_carryover]
                            bonus=no
                            carryover_percentage=10
                        [/gold_carryover]
                    [/objectives]
                [/then]
            [/if]
        )}
    [/event]

    #trap
    [event]
        name=moveto
        [filter]
            id=Rhaxiz
            [filter_location]
                x,y=34,21
                radius=12
            [/filter_location]
        [/filter]

        {UNIT 3 (EoMa_Goblin_Hunter) $x1 $y1 (generate_name=yes
        random_traits=yes)}
        {UNIT 3 (EoMa_Goblin_Hunter) $x1 $y1 (generate_name=yes
        random_traits=yes)}

        {BADASS_MODE_CHANGE () (
            [message]
                speaker=Mehir
                image=portraits/mehir-angry.png
                message= _ "Damn, it’s a trap!"
            [/message]
        )}
    [/event]

    #Rhaxiz reaches the keep
    [event]
        name=moveto
        [filter]
            id=Rhaxiz
            x,y=34,21
        [/filter]

        [message]
            speaker=Rhaxiz
            message= _ "SHATRISS XIFAAAAR!!!"
        [/message]
        [gold]
            side=2
            {QUANTITY amount 400 300 220}
        [/gold]
        [message]
            speaker=Mehir
            image=portraits/mehir-happy.png
            message= _ "Now this battle's gonna be a piece of cake!"
        [/message]

        [store_side]
            side=3
            variable=broghurside
        [/store_side]
        {VARIABLE_OP broghurside.income add 15}
        [modify_side]
            side=3
            income=$broghurside.income
        [/modify_side]
        {CLEAR_VARIABLE broghurside}

        [gold]
            side=3
            {QUANTITY amount 300 400 470}
        [/gold]

        {VARIABLE turn_aa $turn_number}
        {VARIABLE turn_rocs $turn_number}
        {VARIABLE_OP turn_aa add 2}
        {VARIABLE_OP turn_rocs add 4}

        [modify_side]
            side=2
            [ai]
                grouping=no
                aggression=1.0
            [/ai]
        [/modify_side]

        [objectives]
            side=1
            [objective]
                description= _ "Kill Brogh’ur"
                condition=win
            [/objective]
            [objective]
                description= _ "Death of Rhaxiz"
                condition=lose
            [/objective]
            [objective]
                description= _ "Death of Mehir"
                condition=lose
            [/objective]
            {TURNS_RUN_OUT}
            [gold_carryover]
                bonus=no
                carryover_percentage=10
            [/gold_carryover]
        [/objectives]
    [/event]

    #Messenger appears
    [event]
        name=new turn
        first_time_only=no
        [if]
            [variable]
                name=turn_number
                equals=$turn_aa
            [/variable]
            [then]
                {UNIT 2 TLU_DB_Messenger1 18 7 (generate_name=yes
                id=messenger
                random_traits=yes)}

                [if]
                    [have_unit]
                        id=Mehir
                        x,y=19,8
                    [/have_unit]
                    [then]
                        [message]
                            speaker=messenger
                            message= _ "pssst!"
                        [/message]
                        [message]
                            speaker=Mehir
                            message= _ "Huh?"
                        [/message]
                        {GIFT_MESSAGE}
                    [/then]
                    [else]
                        [message]
                            speaker=Mehir
                            message= _ "Hey, I think there's a salamander near my camp, calling me. I better take a look..."
                        [/message]
                        {VARIABLE outside_keep 1}
                        {PLACE_IMAGE "items/gohere.png" 19 8}

                        {HIGHLIGHT_IMAGE 19 8 "items/gohere.png" ()}
                    [/else]
                [/if]
                {CLEAR_VARIABLE turn_aa}
            [/then]
        [/if]
    [/event]

    #Mehir talks with Messenger
    [event]
        name=moveto
        first_time_only=no
        [filter]
            id=Mehir
            x,y=19,8
        [/filter]

        [if]
            [variable]
                name=outside_keep
                equals=1
            [/variable]
            [then]
                {CLEAR_VARIABLE outside_keep}
                {REMOVE_IMAGE 19 8}
                {GIFT_MESSAGE}
            [/then]
        [/if]
    [/event]

    #Rocs arrive
    [event]
        name=side 1 turn
        first_time_only=no
        [if]
            [variable]
                name=turn_number
                equals=$turn_rocs
            [/variable]
            [then]
#ifndef HARD
                {UNIT 3 (EoMa_Roc_Rider) 7 15 id,facing,animate=captain,se,yes}
#endif
#ifdef HARD
                {UNIT 3 (EoMa_Roc_Master) 7 15 id,facing,animate=captain,se,yes}
#endif
                {UNIT 3 (EoMa_Roc_Rider) 6 14 (facing,animate=se,yes)}
                {UNIT 3 (EoMa_Roc_Rider) 7 14 (facing,animate=se,yes)}
                {UNIT 3 (EoMa_Roc_Rider) 5 14 (facing,animate=se,yes)}
                {UNIT 3 (EoMa_Roc_Rider) 7 13 (facing,animate=se,yes)}
                [message]
                    id=captain
                    message= _ "Take them!!! Rip their eyes out!!!"
                [/message]
                {BADASS_MODE_CHANGE (
                    [message]
                        speaker=Mehir
                        message= _ "My liege, the enemy reinforcements arrived!"
                    [/message]
                    [message]
                        speaker=Jaffar
                        message= _ "I see them. It's time to release my red servants!"
                    [/message]
                    [store_unit]
                        variable=jaffarloc
                        [filter]
                            id=Jaffar
                        [/filter]
                    [/store_unit]
                    {UNIT 4 (EoMa_Efreet) $jaffarloc.x $jaffarloc.y (generate_name,random_traits,animate=yes,yes,yes)}
                    {UNIT 4 (EoMa_Efreet) $jaffarloc.x $jaffarloc.y (generate_name,random_traits,animate=yes,yes,yes)}
                    [message]
                        type=EoMa_Efreet
                        message= _ "At last! Who shall I torture, my master?"
                    [/message]
                    [message]
                        speaker=Jaffar
                        message= _ "Take those natives! Show them your anger!"
                    [/message]
                    [message]
                        type=EoMa_Efreet
                        message= _ "With pleasure! MWAHAHAA!"
                    [/message]
                    {CLEAR_VARIABLE jaffarloc}
                ) (
                    [message]
                        speaker=Mehir
                        image=portraits/mehir-shocked.png
                        message= _ "!!!"
                    [/message]
                )}
                {CLEAR_VARIABLE turn_rocs}
            [/then]
        [/if]
    [/event]

    #Brogh'ur dies
    [event]
        name=last breath
        [filter]
            id=Broghur
        [/filter]
        {BADASS_MODE_CHANGE (
            [message]
                speaker=Broghur
                message= _ "Damn you, desert wizards!!! You may have won today, but mark my words, the horde will avenge my death!!!"
            [/message]
        ) (
            [message]
                speaker=Broghur
                message= _ "Damn you, lizard-loving bastards!!! You may have won today, but mark my words, the horde will avenge my death!!!"
            [/message]
        )}
    [/event]
    [event]
        name=die
        [filter]
            id=Broghur
        [/filter]
        [message]
            speaker=Rhaxiz
            message= _ "Shatizakaaaaiii!"
        [/message]
        [message]
            [not]
                id=Broghur
            [/not]
            [and]
                side=3
            [/and]
            message= _ "Brogh’ur’s dead! Run!!!"
        [/message]
        [if]
            [have_unit]
                [and]
                    side=3
                [/and]
                [not]
                    id=Broghur
                [/not]
            [/have_unit]
            [then]
                [store_unit]
                    variable=retreat
                    [filter]
                        [and]
                            side=3
                        [/and]
                        [not]
                            id=Broghur
                        [/not]
                    [/filter]
                    kill=no
                [/store_unit]

                [foreach]
                    array=retreat
                    [do]
                        {MOVE_UNIT x,y=$this_item.x,$this_item.y 2 24}
                        [kill]
                            x,y=1,24
                            animate=no
                        [/kill]
                    [/do]
                [/foreach]
                {CLEAR_VARIABLE retreat}
            [/then]
        [/if]
        [message]
            speaker=Mehir
            image=portraits/mehir-happy.png
            message= _ "We did it! We actually won!"
        [/message]
        {MODIFY_UNIT type=EoMa_Efreet,EoMa_Great_Efreeti side 4}
        [endlevel]
            result=victory
            carryover_report=yes
            bonus=no
            {NEW_GOLD_CARRYOVER 10}
            linger_mode=no
        [/endlevel]
    [/event]

    #victory
    [event]
        name=victory
        [delay]
            time=500
        [/delay]
        [message]
            speaker=Mehir
            message= _ "Do you hear that? It’s like the sound of flapping wings..."
        [/message]
        [delay]
            time=500
        [/delay]
        {FAKE_UNIT_MOVE 37 14 28 16 2 (TLU_animhack) (variation=fakewave3)}
        [unit]
            type=TLU_animhack
            variation=fakewave3
            random_traits=yes
            side=2
            x=15
            y=17
            placement=map
        [/unit]
        [message]
            speaker=narrator
            caption= _ "Chaos Wyvern Rider"
            image="portraits/darkblood/chaosrider.png"
            message= _ "RRRHHHAAAAHHH! Sur kav NAX!!!"
        [/message]
        {BADASS_MODE_CHANGE (
            [message]
                speaker=Jaffar
                image=portraits/jaffar-shocked.png
                message= _ "Uhhh... We might have to surrender now..."
            [/message]
        ) (
            [message]
                speaker=Mehir
                image=portraits/mehir-shocked.png
                message= _ "Uhhh... I think we got a problem..."
            [/message]
        )}
        [if]
            [variable]
                name=gift
                equals=1
            [/variable]
            [then]
                {MODIFY_UNIT (side=1
                type=EoMa_Efreet,EoMa_Great_Efreeti) side 4}
            [/then]
        [/if]
        {CLEAR_VARIABLE bcounter}
        {CLEAR_VARIABLE gift}
    [/event]

    #deaths
    #Messenger
    [event]
        name=die
        [filter]
            type=I8_DB_Messenger
        [/filter]

        {CLEAR_VARIABLE outside_keep}
        {REMOVE_IMAGE 19 8}
    [/event]

    #Krog
    [event]
        name=last breath
        [filter]
            id=Krog
        [/filter]
        [message]
            speaker=Krog
            message= _ "ROOOOAAAARRRRR!!!"
        [/message]
    [/event]

    #Rhaxiz
    [event]
        name=die
        [filter]
            id=Rhaxiz
        [/filter]

        {BADASS_MODE_CHANGE (
            {IF_VAR spotted equals yes (
                [then]
                    [message]
                        speaker=Broghur
                        message= _ "Finally, the green scum are no more! I shall claim this territory as ours! Secure the area! Leave no survivors!"
                    [/message]
                [/then]
            )}
            [gold]
                side=3
                {QUANTITY amount 200 300 370}
            [/gold]
        ) (
            [if]
                [variable]
                    name=bcounter
                    less_than=2
                [/variable]
                [then]
                    [message]
                        speaker=Mehir
                        message= _ "The lizard leader is dead. We might have lost our only chance..."
                    [/message]
                    [endlevel]
                        result=defeat
                    [/endlevel]
                [/then]
                [else]
                    [message]
                        speaker=Mehir
                        message= _ "Nooo!!!"
                    [/message]
                    [endlevel]
                        result=defeat
                    [/endlevel]
                [/else]
            [/if]
        )}
    [/event]

    ##Various events
    #Stealing Jaffar's village
    [event]
        name=moveto
        [filter]
            side=1
            [filter_location]
                x,y=28,4
            [/filter_location]
            [or]
                side=1
                [filter_location]
                    x,y=29,4
                [/filter_location]
            [/or]
            [or]
                side=1
                [filter_location]
                    x,y=21,2
                [/filter_location]
            [/or]
            [or]
                side=1
                [filter_location]
                    x,y=20,2
                [/filter_location]
            [/or]
        [/filter]

        [if]
            [variable]
                name=gift
                not_equals=1
            [/variable]
            [then]
                [message]
                    speaker=Jaffar
                    image=portraits/jaffar-angry.png
                    message= _ "Mehir! You thief! Take him!"
                [/message]
                [endlevel]
                    result=defeat
                [/endlevel]
            [/then]
        [/if]
    [/event]

    #Mehir brings enemies too close to Jaffar
    [event]
        name=moveto
        [filter]
            side=3,2
            [filter_location]
                x,y=27,5
                radius=5
            [/filter_location]
        [/filter]

        {BADASS_MODE_CHANGE () (
            [if]
                [variable]
                    name=gift
                    not_equals=1
                [/variable]
                [then]
                    [message]
                        speaker=Jaffar
                        image=portraits/jaffar-angry.png
                        message= _ "Mehir! What did I say about not bringing those beasts here?!"
                    [/message]

                    [endlevel]
                        result=defeat
                    [/endlevel]
                [/then]
            [/if]
        )}
    [/event]

    #badass - enemies are too close to the circle
    [event]
        name=moveto
        [filter]
            side=3,2
            [filter_location]
                x,y=22,7
                radius=4
            [/filter_location]
        [/filter]

        {BADASS_MODE_CHANGE (
            {VARIABLE spotted yes}
            [print]
                text=" "
                duration=300
            [/print]
            [unhide_unit]
                side=1,4
            [/unhide_unit]
            [remove_shroud]
                side=1
                x,y=22,7
                radius=40
            [/remove_shroud]
            {FADE_IN}
            [if]
                [have_unit]
                    id=Krog
                    x,y=$x1,$y1
                [/have_unit]
                [then]
                    [message]
                        speaker=Krog
                        message= _ "KROG FIND HUMANZ! CAN KROG KILL?"
                    [/message]
                    [message]
                        speaker=Broghur
                        message= _ "H...Humans?! What the hell is going on here?! Nevermind, we must finish what we started! KILL THEM!!!"
                    [/message]
                [/then]
            [/if]
            [if]
                [have_unit]
                    side=3
                    x,y=$x1,$y1
                    [not]
                        id=Krog
                    [/not]
                [/have_unit]
                [then]
                    [message]
                        speaker=unit
                        message= _ "Chief, me find humans in jungle! What do we do?"
                    [/message]
                    [message]
                        speaker=Broghur
                        message= _ "H...Humans?! What the hell is going on here?! Nevermind, we must finish what we started! KILL THEM!!!"
                    [/message]
                [/then]
            [/if]
            [message]
                speaker=Mehir
                message= _ "Uh, sir? We have a problem. The natives founds us, and are about to concentrate all their forces on us!"
            [/message]
            [message]
                speaker=Jaffar
                image=portraits/jaffar-angry.png
                message= _ "Damn it! I shouldn't have relied on their squabbling! EVERYONE TO ARMS! WE ARE UNDER ATTACK!"
            [/message]

            [modify_side]
                side=4
                team_name=mehirteam
            [/modify_side]

            [gold]
                side=4
                {QUANTITY amount 400 350 300}
            [/gold]

            {MODIFY_UNIT side=4 status.guardian no}

            [modify_side]
                side=3
                [ai]
                    leader_ignores_keep=yes
                    [leader_goal]
                        x,y=27,6
                        max_risk=1
                    [/leader_goal]
                [/ai]
            [/modify_side]

            [modify_side]
                side=4
                [ai]
                    [leader_goal]
                        x,y=27,5
                    [/leader_goal]
                [/ai]
            [/modify_side]

            {VARIABLE turn_rocs $turn_number}
            {VARIABLE_OP turn_rocs add 4}

            [objectives]
                side=1
                [objective]
                    description= _ "Defeat the barbarians."
                    condition=win
                [/objective]
                [objective]
                    description= _ "Death of Mehir"
                    condition=lose
                [/objective]
                [objective]
                    description= _ "Death of Jaffar"
                    condition=lose
                [/objective]
                {TURNS_RUN_OUT}
                [gold_carryover]
                    bonus=no
                    carryover_percentage=10
                [/gold_carryover]
                note=_"Do not capture Jaffar's villages"
            [/objectives]
        ) ()}
    [/event]

    #Jaffar dies = game over
    [event]
        name=die
        [filter]
            id=Jaffar
        [/filter]

        [endlevel]
            result=defeat
        [/endlevel]
    [/event]

    {SUMMONER_LOCK}
    {JINN_LOCK}
    {DEATH_MEHIR}
    {TLU_S04_TERRAIN}
[/scenario]
