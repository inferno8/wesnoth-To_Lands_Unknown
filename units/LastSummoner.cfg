#textdomain wesnoth-To_Lands_Unknown
[unit_type]
    id=TLU_The_Last_Summoner
    name= _ "The Last Summoner"
    race=eoma_summoner
    image="units/thelastsummoner.png"
    image_icon=portraits/mehir-last.png~CROP(131,50,130,130)~SCALE(72,72)
    ellipse="misc/ellipse"

    hitpoints=82
    movement_type=smallfoot
    movement=5
    experience=200
    level=5
    alignment=lawful
    advances_to=null
    cost=999
    {MEHIR_LAST_SUMMONER_AMLAS}
    usage=mixed fighter
    description= _ "Thanks to collaboration with the Sky Kingdom magi, Mehir's personal megacircle has been greatly improved, granting him more powerful spells and the one-of-a-kind ability to teleport his troops directly to a battlefield without worrying about logistics."
    die_sound={SOUND_LIST:HUMAN_DIE}
    [movement_costs]
        sand=1
    [/movement_costs]
    [defense]
        sand=60
    [/defense]
    [defend]
        start_time=-126
        circle1_start_time=-126
        circle2_start_time=-126
        circle3_start_time=--126
        circle4_start_time=-126
        circle5_start_time=-126
        particle_start_time=-126
        [particle_frame]
            duration=250
            image="halo/particle-anims/particles-a-[01~96].png"
            image_mod="~SCALE(270,270)~BLEND(102,255,255,0.6)"
            auto_vflip=false
            auto_hflip=false
            layer=30
            alpha=0~0.5:75,0.5:100,0.5~0:75
        [/particle_frame]
        #red
        [circle1_frame]
            duration=250
            image=halo/ucircle-frames/ucircle-b-[07~23].png
            image_mod="~SCALE(270,190)~GS()~BLEND(255,0,0,1)"
            auto_vflip=false
            y=18
            layer=0
            alpha=0.6~0.8:500,0.8~0.6:500
            offset=0.0
        [/circle1_frame]
        #thebigone
        [circle2_frame]
            duration=250
            image=halo/ucircle-frames/ucircle-a-[23~01].png
            image_mod="~SCALE(270,190)~GS()~BLEND(0,0,0,0.9)"
            auto_vflip=false
            y=18
            layer=0
            alpha=0.8~1:500,1~0.8:500
            offset=0.0
        [/circle2_frame]
        [circle3_frame]
            duration=250
            image=halo/ucircle-frames/ucircle-b-[23~07].png
            image_mod="~SCALE(189,133)~GS()~BLEND(61,191,253,1)"
            auto_vflip=false
            y=18
            layer=0
            alpha=0.8~1:500,1~0.8:500
            offset=0.0
        [/circle3_frame]
        [circle4_frame]
            duration=250
            image=halo/ucircle-frames/ucircle-b-[07~23].png
            image_mod="~SCALE(108,76)"
            auto_vflip=false
            y=18
            layer=0
            alpha=0.8~1:500,1~0.8:500
            offset=0.0
        [/circle4_frame]
        [circle5_frame]
            duration=250
            image=halo/ucircle-frames/ucircle-e-[23~01].png
            image_mod="~SCALE(81,51)"
            auto_vflip=false
            y=18
            layer=0
            alpha=0.8~1:500,1~0.8:500
            offset=0.0
        [/circle5_frame]
        [frame]
            image="units/thelastsummoner.png":1,"units/thelastsummoner-attack-magic.png":250,"units/thelastsummoner.png":1
        [/frame]
        [if]
            hit_sound_start_time=-25
            hits=hit
            [hit_sound_frame]
                sound={SOUND_LIST:HUMAN_OLD_HIT}
            [/hit_sound_frame]
        [/if]
    [/defend]
    [resistance]
        blade=90
        pierce=90
        impact=90
        fire=70
        cold=70
        arcane=70
    [/resistance]
    [abilities]
        [regenerate]
            value=8
            id=eoma_healing
            name= _ "ultimate circle"
            description= _ "This unit is equipped with the most powerful kind of magical circle. The owner can recruit and recall units without being in keeps (it doesn’t work in forests). All adjacent friendly units fight better (+125%, +100%, +75%, +50%, +25% — levels 0, 1, 2, 3, 4 respectively), are healed by 8 points, and receive a +20% bonus to their fire, cold, and arcane resistances. At the beginning of each turn, all adjacent enemy units are slowed and receive 8 points of damage."
            affect_self=yes
            poison=cured
        [/regenerate]
        [heals]
            value=8
            id=eoma_healing
            affect_allies=yes
            affect_self=no
            poison=slowed
            [affect_adjacent]
                adjacent=n,ne,se,s,sw,nw
            [/affect_adjacent]
        [/heals]
        [heals]
            affect_allies=yes
            id=eoma_curing
            affect_self=no
            poison=cured
            [affect_adjacent]
                adjacent=n,ne,se,s,sw,nw
            [/affect_adjacent]
        [/heals]
        [leadership]
            id=leadership
            value=125
            cumulative=no
            affect_self=no
            [affect_adjacent]
                adjacent=n,ne,se,s,sw,nw
                [filter]
                    level=0
                [/filter]
            [/affect_adjacent]
        [/leadership]
        [leadership]
            id=leadership
            value=100
            cumulative=no
            affect_self=no
            [affect_adjacent]
                adjacent=n,ne,se,s,sw,nw
                [filter]
                    level=1
                [/filter]
            [/affect_adjacent]
        [/leadership]
        [leadership]
            id=leadership
            value=75
            cumulative=no
            affect_self=no
            [affect_adjacent]
                adjacent=n,ne,se,s,sw,nw
                [filter]
                    level=2
                [/filter]
            [/affect_adjacent]
        [/leadership]
        [leadership]
            id=leadership
            value=50
            cumulative=no
            affect_self=no
            [affect_adjacent]
                adjacent=n,ne,se,s,sw,nw
                [filter]
                    level=3
                [/filter]
            [/affect_adjacent]
        [/leadership]
        [leadership]
            id=leadership
            value=25
            cumulative=no
            affect_self=no
            [affect_adjacent]
                adjacent=n,ne,se,s,sw,nw
                [filter]
                    level=4
                [/filter]
            [/affect_adjacent]
        [/leadership]
        [resistance]
            id=cr
            add=20
            max_value=100
            apply_to=fire,cold,arcane
            affect_self=no
            affect_allies=yes
            [affect_adjacent]
                adjacent=n,ne,se,s,sw,nw
                [filter]
                    [not]
                        [filter_adjacent]
                            ability=eoma_circleres
                            is_enemy=no
                        [/filter_adjacent]
                        [or]
                            ability=eoma_magicabsorb
                        [/or]
                        [or]
                            [filter_adjacent]
                                ability=eoma_magicabsorb
                            [/filter_adjacent]
                        [/or]
                    [/not]
                [/filter]
            [/affect_adjacent]
        [/resistance]
        {ABILITY_EOMA_SUMMON mehirlast (
            {SUMMON_MENU_ITEM 6_3_1 ( _ "Summon Fire Elemental") 7 (TLU_The_Last_Summoner) (EoMa_Fire_Elemental)}
            {SUMMON_MENU_ITEM 6_3_2 ( _ "Summon Water Elemental") 6 (TLU_The_Last_Summoner) (EoMa_Water_Elemental)}
            {SUMMON_MENU_ITEM 6_3_3 ( _ "Summon Air Elemental") 9 (TLU_The_Last_Summoner) (EoMa_Air_Elemental)}
            {SUMMON_MENU_ITEM 6_3_4 ( _ "Summon Earth Elemental") 8 (TLU_The_Last_Summoner) (EoMa_Earth_Elemental)}
        )}
    [/abilities]
    [standing_anim]
        start_time=0
        overlay_start_time=1000
        circle1_start_time=0
        circle2_start_time=0
        circle3_start_time=-1
        circle4_start_time=0
        circle5_start_time=0
        particle_start_time=0
        [particle_frame]
            duration=4000
            image="halo/particle-anims/particles-a-[01~96].png"
            image_mod="~SCALE(270,270)~BLEND(102,255,255,0.6)"
            auto_vflip=false
            auto_hflip=false
            layer=30
            alpha=0~1:500,1:3000,1~0:500
        [/particle_frame]
        #red
        [circle1_frame]
            duration=1000
            image=halo/ucircle-frames/ucircle-b-[07~23].png
            image_mod="~SCALE(270,190)~GS()~BLEND(255,0,0,1)"
            auto_vflip=false
            y=18
            layer=0
            alpha=0.6~0.8:500,0.8~0.6:500
            offset=0.0
        [/circle1_frame]
        #thebigone
        [circle2_frame]
            duration=1000
            image=halo/ucircle-frames/ucircle-a-[23~01].png
            image_mod="~SCALE(270,190)~GS()~BLEND(0,0,0,0.9)"
            auto_vflip=false
            y=18
            layer=0
            alpha=0.8~1:500,1~0.8:500
            offset=0.0
        [/circle2_frame]
        [circle3_frame]
            duration=1000
            image=halo/ucircle-frames/ucircle-b-[23~07].png
            image_mod="~SCALE(189,133)~GS()~BLEND(61,191,253,1)"
            auto_vflip=false
            y=18
            layer=0
            alpha=0.8~1:500,1~0.8:500
            offset=0.0
        [/circle3_frame]
        [circle4_frame]
            duration=1000
            image=halo/ucircle-frames/ucircle-b-[07~23].png
            image_mod="~SCALE(108,76)"
            auto_vflip=false
            y=18
            layer=0
            alpha=0.8~1:500,1~0.8:500
            offset=0.0
        [/circle4_frame]
        [circle5_frame]
            duration=1000
            image=halo/ucircle-frames/ucircle-e-[23~01].png
            image_mod="~SCALE(81,51)"
            auto_vflip=false
            y=18
            layer=0
            alpha=0.8~1:500,1~0.8:500
            offset=0.0
        [/circle5_frame]
        [frame]
            image="units/thelastsummoner.png:100"
            layer=30
            auto_vflip=no
        [/frame]
        [overlay_frame]
            image="units/summoners-humans/summonerIVb.png:5000"
            image_mod="~GS()~BLEND(255,0,0,1)"
            alpha=0.0~0.6:2500,0.6~0.0:2500
            layer=41
            y=18
            auto_vflip=no
        [/overlay_frame]
        [overlay_frame]
            image="units/summoners-humans/summonerIVb.png:5000"
            image_mod="~GS()~BLEND(58,128,253,1)"
            alpha=0.0~0.6:2500,0.6~0.0:2500
            layer=41
            y=18
            auto_vflip=no
        [/overlay_frame]
        [overlay_frame]
            image="units/summoners-humans/summonerIVb.png:5000"
            image_mod="~GS()~BLEND(239,225,165,1)"
            alpha=0.0~0.6:2500,0.6~0.0:2500
            layer=41
            y=18
            auto_vflip=no
        [/overlay_frame]
    [/standing_anim]
    [movement_anim]
        start_time=0
        circle1_start_time=0
        circle2_start_time=0
        circle3_start_time=-1
        circle4_start_time=0
        circle5_start_time=0
        #red
        [circle1_frame]
            duration=200
            image=halo/ucircle-frames/ucircle-b-07.png
            image_mod="~SCALE(270,190)~GS()~BLEND(255,0,0,1)"
            auto_vflip=false
            y=18
            layer=0
            alpha=0.7
            offset=0~1:200
        [/circle1_frame]
        #thebigone
        [circle2_frame]
            duration=200
            image=halo/ucircle-frames/ucircle-a-23.png
            image_mod="~SCALE(270,190)~GS()~BLEND(0,0,0,0.9)"
            auto_vflip=false
            y=18
            layer=0
            alpha=0.9
            offset=0~1:200
        [/circle2_frame]
        [circle3_frame]
            duration=200
            image=halo/ucircle-frames/ucircle-b-23.png
            image_mod="~SCALE(189,133)~GS()~BLEND(61,191,253,1)"
            auto_vflip=false
            y=18
            layer=0
            alpha=0.9
            offset=0~1:200
        [/circle3_frame]
        [circle4_frame]
            duration=200
            image=halo/ucircle-frames/ucircle-b-07.png
            image_mod="~SCALE(108,76)"
            auto_vflip=false
            y=18
            layer=0
            alpha=0.9
            offset=0~1:200
        [/circle4_frame]
        [circle5_frame]
            duration=200
            image=halo/ucircle-frames/ucircle-e-23.png
            image_mod="~SCALE(81,51)"
            auto_vflip=false
            y=18
            layer=0
            alpha=0.9
            offset=0~1:200
        [/circle5_frame]
        [frame]
            image="units/thelastsummoner.png:200"
            layer=30
            auto_vflip=no
        [/frame]
    [/movement_anim]
    [healing_anim]
        start_time=0
        circle1_start_time=0
        circle2_start_time=0
        circle3_start_time=-1
        circle4_start_time=0
        circle5_start_time=0
        particle_start_time=0
        overlay_start_time=0
        [particle_frame]
            duration=650
            image="halo/particle-anims/particles-a-[01~96].png"
            image_mod="~SCALE(270,270)~BLEND(102,255,255,0.6)"
            auto_vflip=false
            auto_hflip=false
            layer=30
            alpha=0~1:100,1:450,1~0:100
        [/particle_frame]
        [overlay_frame]
            image="units/summoners-humans/summonerIVb.png:650"
            alpha=0.0~0.6:325,0.6~0.0:325
            layer=41
            y=18
            auto_vflip=no
        [/overlay_frame]
        #red
        [circle1_frame]
            duration=650
            image=halo/ucircle-frames/ucircle-b-[07~23].png
            image_mod="~SCALE(270,190)~GS()~BLEND(0,16,255,1)"
            auto_vflip=false
            y=18
            layer=0
            alpha=0.6~0.8:500,0.8~0.6:500
            offset=0.0
        [/circle1_frame]
        #thebigone
        [circle2_frame]
            duration=650
            image=halo/ucircle-frames/ucircle-a-[23~01].png
            image_mod="~SCALE(270,190)~GS()~BLEND(0,0,0,0.9)"
            blend_color=0,16,255
            blend_ratio=0.1
            auto_vflip=false
            y=18
            layer=0
            alpha=0.8~1:500,1~0.8:500
            offset=0.0
        [/circle2_frame]
        [circle3_frame]
            duration=650
            image=halo/ucircle-frames/ucircle-b-[23~07].png
            image_mod="~SCALE(189,133)~GS()~BLEND(61,191,253,1)"
            auto_vflip=false
            y=18
            layer=0
            alpha=0.8~1:500,1~0.8:500
            offset=0.0
        [/circle3_frame]
        [circle4_frame]
            duration=650
            image=halo/ucircle-frames/ucircle-b-[07~23].png
            image_mod="~SCALE(108,76)~GS()"
            blend_color=0,16,255
            blend_ratio=0.8
            auto_vflip=false
            y=18
            layer=0
            alpha=0.8~1:500,1~0.8:500
            offset=0.0
        [/circle4_frame]
        [circle5_frame]
            duration=650
            image=halo/ucircle-frames/ucircle-e-[23~01].png
            image_mod="~SCALE(81,51)"
            auto_vflip=false
            y=18
            layer=0
            alpha=0.8~1:500,1~0.8:500
            offset=0.0
        [/circle5_frame]
        [frame]
            image="units/thelastsummoner-attack-magic.png:650"
        [/frame]
    [/healing_anim]
    {LASTSUMMONER_RECRUIT_ANIMS}
    [attack]
        name=magical scimitar
        description=_"magical scimitar"
        icon=attacks/scimitar2.png
        type=blade
        range=melee
        damage=10
        number=4
        [specials]
            {WEAPON_SPECIAL_MAGICAL}
        [/specials]
    [/attack]
    [attack]
        name=hammer
        description=_ "magical hammer"
        icon=attacks/hammer-summons.png
        type=impact
        range=melee
        damage=20
        number=2
        [specials]
            {WEAPON_SPECIAL_MAGICAL}
        [/specials]
    [/attack]
    [attack]
        name=circle of destruction
        description=_"circle of destruction"
        icon=attacks/circle-destr.png
        type=fire
        range=ranged
        [specials]
            {WEAPON_SPECIAL_EOMA_ALWAYSHITS}
        [/specials]
        damage=33
        number=1
    [/attack]
    [attack]
        name=incantation of power
        description=_"incantation of power"
        icon=attacks/circle-advance.png
        type=secret
        range=ranged
        [specials]
            {WEAPON_SPECIAL_EOMA_PRECISION}
            {WEAPON_SPECIAL_EOMA_ANTISHIELD}
        [/specials]
        damage=48
        number=1
    [/attack]
    [attack_anim]
        [filter_attack]
            name=magical scimitar
        [/filter_attack]
        circle1_start_time=-250
        circle2_start_time=-250
        circle3_start_time=-251
        circle4_start_time=-250
        circle5_start_time=-250
        #red
        [circle1_frame]
            duration=450
            image=halo/ucircle-frames/ucircle-b-[07~23].png
            image_mod="~SCALE(270,190)~GS()~BLEND(255,0,0,1)"
            auto_vflip=false
            y=18
            layer=0
            alpha=0.6~0.8:500,0.8~0.6:500
            offset=0~0.6:255,0.6~0:255
        [/circle1_frame]
        #thebigone
        [circle2_frame]
            duration=450
            image=halo/ucircle-frames/ucircle-a-[23~01].png
            image_mod="~SCALE(270,190)~GS()~BLEND(0,0,0,0.9)"
            auto_vflip=false
            y=18
            layer=0
            alpha=0.8~1:500,1~0.8:500
            offset=0~0.6:255,0.6~0:255
        [/circle2_frame]
        [circle3_frame]
            duration=450
            image=halo/ucircle-frames/ucircle-b-[23~07].png
            image_mod="~SCALE(189,133)~GS()~BLEND(61,191,253,1)"
            auto_vflip=false
            y=18
            layer=0
            alpha=0.8~1:500,1~0.8:500
            offset=0~0.6:255,0.6~0:255
        [/circle3_frame]
        [circle4_frame]
            duration=450
            image=halo/ucircle-frames/ucircle-b-[07~23].png
            image_mod="~SCALE(108,76)"
            auto_vflip=false
            y=18
            layer=0
            alpha=0.8~1:500,1~0.8:500
            offset=0~0.6:255,0.6~0:255
        [/circle4_frame]
        [circle5_frame]
            duration=450
            image=halo/ucircle-frames/ucircle-e-[23~01].png
            image_mod="~SCALE(81,51)"
            auto_vflip=false
            y=18
            layer=0
            alpha=0.8~1:500,1~0.8:500
            offset=0~0.6:255,0.6~0:255
        [/circle5_frame]
        [frame]
            image="units/thelastsummoner.png:100"
            layer=30
            auto_vflip=no
        [/frame]
        [overlay_frame]
            image="units/summoners-humans/summonerIVb.png:450"
            image_mod="~GS()~BLEND(255,0,0,1)"
            alpha=0.2
            layer=41
            y=18
            auto_vflip=no
            offset=0~0.6:255,0.6~0:255
        [/overlay_frame]
        start_time=-250
        [frame]
            image="units/thelastsummone[r,r-attack-1,r-attack-2,r-attack-1,r].png:[50,100*2,50*2]"
        [/frame]
        {SOUND:HIT_AND_MISS {SOUND_LIST:SWORD_SWISH} {SOUND_LIST:MISS} -100}
    [/attack_anim]
    [attack_anim]
        [filter_attack]
            name=hammer
        [/filter_attack]
        circle1_start_time=-250
        circle2_start_time=-250
        circle3_start_time=-251
        circle4_start_time=-250
        circle5_start_time=-250
        #red
        [circle1_frame]
            duration=450
            image=halo/ucircle-frames/ucircle-b-[07~23].png
            image_mod="~SCALE(270,190)~GS()~BLEND(255,0,0,1)"
            auto_vflip=false
            y=18
            layer=0
            alpha=0.6~0.8:500,0.8~0.6:500
            offset=0~0.6:255,0.6~0:255
        [/circle1_frame]
        #thebigone
        [circle2_frame]
            duration=450
            image=halo/ucircle-frames/ucircle-a-[23~01].png
            image_mod="~SCALE(270,190)~GS()~BLEND(0,0,0,0.9)"
            auto_vflip=false
            y=18
            layer=0
            alpha=0.8~1:500,1~0.8:500
            offset=0~0.6:255,0.6~0:255
        [/circle2_frame]
        [circle3_frame]
            duration=450
            image=halo/ucircle-frames/ucircle-b-[23~07].png
            image_mod="~SCALE(189,133)~GS()~BLEND(61,191,253,1)"
            auto_vflip=false
            y=18
            layer=0
            alpha=0.8~1:500,1~0.8:500
            offset=0~0.6:255,0.6~0:255
        [/circle3_frame]
        [circle4_frame]
            duration=450
            image=halo/ucircle-frames/ucircle-b-[07~23].png
            image_mod="~SCALE(108,76)"
            auto_vflip=false
            y=18
            layer=0
            alpha=0.8~1:500,1~0.8:500
            offset=0~0.6:255,0.6~0:255
        [/circle4_frame]
        [circle5_frame]
            duration=450
            image=halo/ucircle-frames/ucircle-e-[23~01].png
            image_mod="~SCALE(81,51)"
            auto_vflip=false
            y=18
            layer=0
            alpha=0.8~1:500,1~0.8:500
            offset=0~0.6:255,0.6~0:255
        [/circle5_frame]
        [frame]
            image="units/thelastsummoner.png:100"
            layer=30
            auto_vflip=no
        [/frame]
        [overlay_frame]
            image="units/summoners-humans/summonerIVb.png:450"
            image_mod="~GS()~BLEND(255,0,0,1)"
            alpha=0.2
            layer=41
            y=18
            auto_vflip=no
            offset=0~0.6:255,0.6~0:255
        [/overlay_frame]
        start_time=-250
        [frame]
            image="units/thelastsummone[r,r-attack-1,r-attack-2,r-attack-1,r].png:[50,100*2,50*2]"
        [/frame]
        {SOUND:HIT_AND_MISS mace.wav {SOUND_LIST:MISS} -100}
    [/attack_anim]
#define REDCIRCLE2 VARIATION DIR HALO_X HALO_Y
    [attack_anim]
        [filter_attack]
            name=circle of destruction
        [/filter_attack]
        hits=yes
        direction={DIR}
        circle1_start_time=0
        circle2_start_time=0
        circle3_start_time=-1
        circle4_start_time=0
        circle5_start_time=0
        particle_start_time=0
        overlay_start_time=0
        [particle_frame]
            duration=1000
            image="halo/particle-anims/particles-a-[01~96].png"
            image_mod="~SCALE(270,270)~BLEND(255,32,0,0.6)"
            auto_vflip=false
            auto_hflip=false
            layer=30
            alpha=0~1:100,1:650,1~0:250
        [/particle_frame]
        [overlay_frame]
            image="units/summoners-humans/summonerIVb.png~GS():1000"
            blend_color=255,0,0
            blend_ratio=0.8
            alpha=0.0~0.6:500,0.6~0.0:500
            layer=41
            y=18
            auto_vflip=no
        [/overlay_frame]
        #red
        [circle1_frame]
            duration=1000
            image=halo/ucircle-frames/ucircle-b-[07~23].png
            image_mod="~SCALE(270,190)~GS()~BLEND(255,0,0,1)"
            auto_vflip=false
            y=18
            layer=0
            alpha=0.6~0.8:500,0.8~0.6:500
            offset=0.0
        [/circle1_frame]
        #thebigone
        [circle2_frame]
            duration=1000
            image=halo/ucircle-frames/ucircle-a-[23~01].png
            image_mod="~SCALE(270,190)~GS()~BLEND(0,0,0,0.9)"
            blend_color=255,0,0
            blend_ratio=0.1
            auto_vflip=false
            y=18
            layer=0
            alpha=0.8~1:500,1~0.8:500
            offset=0.0
        [/circle2_frame]
        [circle3_frame]
            duration=1000
            image=halo/ucircle-frames/ucircle-b-[23~07].png
            image_mod="~SCALE(189,133)~GS()"
            blend_color=255,0,0
            blend_ratio=0.8
            auto_vflip=false
            y=18
            layer=0
            alpha=0.8~1:500,1~0.8:500
            offset=0.0
        [/circle3_frame]
        [circle4_frame]
            duration=1000
            image=halo/ucircle-frames/ucircle-b-[07~23].png
            image_mod="~SCALE(108,76)~GS()"
            blend_color=255,0,0
            blend_ratio=0.8
            auto_vflip=false
            y=18
            layer=0
            alpha=0.8~1:500,1~0.8:500
            offset=0.0
        [/circle4_frame]
        [circle5_frame]
            duration=1000
            image=halo/ucircle-frames/ucircle-e-[23~01].png
            image_mod="~SCALE(81,51)~GS()"
            blend_color=255,0,0
            blend_ratio=0.8
            auto_vflip=false
            y=18
            layer=0
            alpha=0.8~1:500,1~0.8:500
            offset=0.0
        [/circle5_frame]
        [missile_frame]
            begin=-250
            end=0
            offset=1.0
        [/missile_frame]
        [frame]
            begin=-800
            end=-600
            image="units/thelastsummoner-attack-magic.png"
            halo=halo/circle-destr-{VARIATION}-1.png:100
            halo_x,halo_y={HALO_X},{HALO_Y}
        [/frame]
        [frame]
            begin=-600
            end=-400
            image="units/thelastsummoner-attack-magic.png"
            halo=halo/circle-destr-{VARIATION}-2.png
            halo_x,halo_y={HALO_X},{HALO_Y}
        [/frame]
        [frame]
            begin=-400
            end=-200
            image="units/thelastsummoner-attack-magic.png"
            halo=halo/circle-destr-{VARIATION}-3.png
            halo_x,halo_y={HALO_X},{HALO_Y}
        [/frame]
        [frame]
            begin=-200
            end=-50
            image="units/thelastsummoner-attack-magic.png"
            halo=halo/circle-destr-{VARIATION}-4.png
            halo_x,halo_y={HALO_X},{HALO_Y}
        [/frame]
        [frame]
            begin=-50
            end=150
            image="units/thelastsummoner-attack-magic.png"
            halo=halo/circle-destr-{VARIATION}-5.png
            halo_x,halo_y={HALO_X},{HALO_Y}
            sound=lightning.ogg
        [/frame]
        [frame]
            begin=150
            end=200
            image="units/thelastsummoner-attack-magic.png"
            halo=halo/circle-destr-{VARIATION}-4.png
            halo_x,halo_y={HALO_X},{HALO_Y}
        [/frame]
    [/attack_anim]
#enddef
    {REDCIRCLE2 1 n 0 -36}
    {REDCIRCLE2 2 s 0 36}
    {REDCIRCLE2 4 ne 27 -18}
    {REDCIRCLE2 4 nw 27 -18}
    {REDCIRCLE2 3 se 27 18}
    {REDCIRCLE2 3 sw 27 18}
#define CIRCLE2 VARIATION DIR HALO_X HALO_Y
    [attack_anim]
        [filter_attack]
            name=incantation of power
        [/filter_attack]
        hits=yes
        direction={DIR}
        circle1_start_time=-600
        circle2_start_time=-600
        circle3_start_time=-600
        circle4_start_time=-600
        circle5_start_time=-600
        particle_start_time=-600
        overlay_start_time=-600
        [particle_frame]
            duration=600
            image="halo/particle-anims/particles-a-[01~96].png"
            image_mod="~SCALE(270,270)~BLEND(255,200,0,0.6)"
            auto_vflip=false
            auto_hflip=false
            layer=30
            alpha=0~1:75,1:425,1~0:100
        [/particle_frame]
        #red
        [circle1_frame]
            duration=600
            image=halo/ucircle-frames/ucircle-b-[07~23].png
            image_mod="~SCALE(270,190)~GS()~BLEND(255,200,0,1)"
            auto_vflip=false
            y=18
            layer=0
            alpha=0.6~0.8:300,0.8~0.6:300
            offset=0.0
        [/circle1_frame]
        #thebigone
        [circle2_frame]
            duration=600
            image=halo/ucircle-frames/ucircle-a-[23~01].png
            image_mod="~SCALE(270,190)~GS()~BLEND(0,0,0,0.9)"
            blend_color=255,200,0
            blend_ratio=0.1
            auto_vflip=false
            y=18
            layer=0
            alpha=0.8~1:300,1~0.8:300
            offset=0.0
        [/circle2_frame]
        [circle3_frame]
            duration=600
            image=halo/ucircle-frames/ucircle-b-[23~07].png
            image_mod="~SCALE(189,133)"#~GS()~BLEND(61,191,253,1)"
            blend_color=255,220,0
            blend_ratio=0.8
            auto_vflip=false
            y=18
            layer=0
            alpha=0.8~1:300,1~0.8:300
            offset=0.0
        [/circle3_frame]
        [circle4_frame]
            duration=600
            image=halo/ucircle-frames/ucircle-b-[07~23].png
            image_mod="~SCALE(108,76)~GS()"
            blend_color=255,220,0
            blend_ratio=0.8
            auto_vflip=false
            y=18
            layer=0
            alpha=0.8~1:300,1~0.8:300
            offset=0.0
        [/circle4_frame]
        [circle5_frame]
            duration=600
            image=halo/ucircle-frames/ucircle-e-[23~01].png
            image_mod="~SCALE(81,51)~GS()"
            blend_color=255,220,0
            blend_ratio=0.8
            auto_vflip=false
            y=18
            layer=0
            offset=0.0
        [/circle5_frame]
        [overlay_frame]
            image="units/summoners-humans/summonerIVb.png:1200"
            image_mod="~GS()~BLEND(239,225,165,1)"
            alpha=0.0~0.6:600,0.6~0.0:600
            layer=41
            y=18
            auto_vflip=no
        [/overlay_frame]
        [missile_frame]
            begin=-250
            end=0
            offset=1.0
        [/missile_frame]
        [frame]
            begin=-600
            end=-500
            image="units/thelastsummoner-attack-magic1.png"
            halo=halo/circle-advance-{VARIATION}-4.png:100
            halo_x,halo_y={HALO_X},{HALO_Y}
        [/frame]
        [frame]
            begin=-500
            end=0
            image="units/thelastsummoner-attack-magic.png"
            halo=halo/circle-advance-{VARIATION}-1.png
            halo_x,halo_y={HALO_X},{HALO_Y}
            sound=lightning.ogg
        [/frame]
        [frame]
            begin=0
            end=200
            image="units/thelastsummoner-attack-magic.png"
            halo=halo/circle-advance-{VARIATION}-2.png
            halo_x,halo_y={HALO_X},{HALO_Y}
        [/frame]
        [frame]
            begin=200
            end=300
            image="units/thelastsummoner-attack-magic.png"
            halo=halo/circle-advance-{VARIATION}-3.png
            halo_x,halo_y={HALO_X},{HALO_Y}
        [/frame]
        [frame]
            begin=300
            end=400
            image="units/thelastsummoner-attack-magic.png"
            halo=halo/circle-advance-{VARIATION}-4.png
            halo_x,halo_y={HALO_X},{HALO_Y}
        [/frame]
        [frame]
            begin=400
            end=600
            image="units/thelastsummoner-attack-magic.png"
            halo=halo/circle-advance-{VARIATION}-5.png
            halo_x,halo_y={HALO_X},{HALO_Y}
        [/frame]
    [/attack_anim]
    [attack_anim]
        [filter_attack]
            name=incantation of power
        [/filter_attack]
        hits=no
        direction={DIR}
        circle1_start_time=-600
        circle2_start_time=-600
        circle3_start_time=-600
        circle4_start_time=-600
        circle5_start_time=-600
        particle_start_time=-600
        overlay_start_time=-600
        [particle_frame]
            duration=600
            image="halo/particle-anims/particles-a-[01~96].png"
            image_mod="~SCALE(270,270)~BLEND(255,200,0,0.6)"
            auto_vflip=false
            auto_hflip=false
            layer=30
            alpha=0~1:100,1:400,1~0:100
        [/particle_frame]
        #red
        [circle1_frame]
            duration=600
            image=halo/ucircle-frames/ucircle-b-[07~23].png
            image_mod="~SCALE(270,190)~GS()~BLEND(255,200,0,1)"
            auto_vflip=false
            y=18
            layer=0
            alpha=0.6~0.8:300,0.8~0.6:300
            offset=0.0
        [/circle1_frame]
        #thebigone
        [circle2_frame]
            duration=600
            image=halo/ucircle-frames/ucircle-a-[23~01].png
            image_mod="~SCALE(270,190)~GS()~BLEND(0,0,0,0.9)"
            blend_color=255,200,0
            blend_ratio=0.1
            auto_vflip=false
            y=18
            layer=0
            alpha=0.8~1:300,1~0.8:300
            offset=0.0
        [/circle2_frame]
        [circle3_frame]
            duration=600
            image=halo/ucircle-frames/ucircle-b-[23~07].png
            image_mod="~SCALE(189,133)"
            blend_color=255,220,0
            blend_ratio=0.8
            auto_vflip=false
            y=18
            layer=0
            alpha=0.8~1:300,1~0.8:300
            offset=0.0
        [/circle3_frame]
        [circle4_frame]
            duration=600
            image=halo/ucircle-frames/ucircle-b-[07~23].png
            image_mod="~SCALE(108,76)~GS()"
            blend_color=255,220,0
            blend_ratio=0.8
            auto_vflip=false
            y=18
            layer=0
            alpha=0.8~1:300,1~0.8:300
            offset=0.0
        [/circle4_frame]
        [circle5_frame]
            duration=600
            image=halo/ucircle-frames/ucircle-e-[23~01].png
            image_mod="~SCALE(81,51)~GS()"
            blend_color=255,220,0
            blend_ratio=0.8
            auto_vflip=false
            y=18
            layer=0
            offset=0.0
        [/circle5_frame]
        [overlay_frame]
            image="units/summoners-humans/summonerIVb.png:600"
            image_mod="~GS()~BLEND(239,225,165,1)"
            alpha=0.0~0.6:300,0.6~0.0:300,0
            layer=41
            y=18
            auto_vflip=no
        [/overlay_frame]
        [missile_frame]
            begin=-250
            end=0
            offset=1.0
        [/missile_frame]
        [frame]
            begin=-600
            end=-500
            image="units/thelastsummoner-attack-magic.png"
            halo=halo/circle-advance-{VARIATION}-4.png:100
            halo_x,halo_y={HALO_X},{HALO_Y}
        [/frame]
        [frame]
            begin=-500
            end=-300
            image="units/thelastsummoner-attack-magic.png"
            halo=halo/circle-advance-{VARIATION}-2.png
            halo_x,halo_y={HALO_X},{HALO_Y}
            sound=lightning.ogg
        [/frame]
        [frame]
            begin=-300
            end=-200
            image="units/thelastsummoner-attack-magic.png"
            halo=halo/circle-advance-{VARIATION}-5.png
            halo_x,halo_y={HALO_X},{HALO_Y}
        [/frame]
        [frame]
            begin=-200
            end=-100
            image="units/thelastsummoner-attack-magic.png"
            halo=halo/circle-advance-{VARIATION}-4.png
            halo_x,halo_y={HALO_X},{HALO_Y}
        [/frame]
        [frame]
            begin=-100
            end=0
            image="units/thelastsummoner-attack-magic.png"
            halo=halo/circle-advance-{VARIATION}-5.png
            halo_x,halo_y={HALO_X},{HALO_Y}
        [/frame]
    [/attack_anim]
#enddef
    # The three variations for the north direction:
    {CIRCLE2 1 n 0 -430}
    # The three variations for the south direction:
    {CIRCLE2 1 s 0 -326}
    # And so on...
    {CIRCLE2 1 ne 54 -404}
    {CIRCLE2 1 nw 54 -404}
    {CIRCLE2 1 se 54 -352}
    {CIRCLE2 1 sw 54 -352}

    [variation]
        variation_id=badass
        inherit=yes
        hide_help=true
        do_not_list=yes
        image_icon="portraits/mehir-last.png~CROP(131,50,130,130)~SCALE(72,72)~BLIT(misc/sunglasses.png~CROP(131,50,130,130)~SCALE(72,72))"
    [/variation]

#define MOVING_CASTLE_ACTION
    [terrain]
        [filter]
            type=TLU_The_Last_Summoner
        [/filter]
        [filter_radius]
            [not]
                terrain=Q*,Mv,Mm^Xm,Md^Xm,Ms^Xm,Mdd^Xm,X*,*^X*,*^Q*
            [/not]
        [/filter_radius]
        radius=1
        terrain=^Cov
        layer=overlay
    [/terrain]

    [terrain]
        [filter]
            type=TLU_The_Last_Summoner
        [/filter]
        terrain=^Kov
        layer=overlay
    [/terrain]
#enddef
    #moving castle event
    [event]
        name=start
        first_time_only=no
        id=moving_keep_action

        {MOVING_CASTLE_ACTION}
    [/event]

    [event]
        name=moveto
        first_time_only=no
        id=moving_keep_restore
        [filter]
            type=TLU_The_Last_Summoner
        [/filter]

        #restore old terrain
        [terrain]
            x,y=$x2,$y2
            [filter_radius]
                [not]
                    terrain=Q*,Mv,Mm^Xm,Md^Xm,Ms^Xm,Mdd^Xm,X*,*^X*,*^Q*
                [/not]
            [/filter_radius]
            radius=1
            terrain="^"
            layer=overlay
        [/terrain]

        #create new castle
        {MOVING_CASTLE_ACTION}

        [allow_undo]
        [/allow_undo]

        [on_undo]
            #restore old terrain
            [terrain]
                x,y=$x1,$y1
                [filter_radius]
                    [not]
                        terrain=Q*,Mv,Mm^Xm,Md^Xm,Ms^Xm,Mdd^Xm,X*,*^X*,*^Q*
                    [/not]
                [/filter_radius]
                radius=1
                terrain="^"
                layer=overlay
            [/terrain]
            [terrain]
                x,y=$x2,$y2
                [filter_radius]
                    [not]
                        terrain=Q*,Mv,Mm^Xm,Md^Xm,Ms^Xm,Mdd^Xm,X*,*^X*,*^Q*
                    [/not]
                [/filter_radius]
                radius=1
                terrain=^Cov
                layer=overlay
            [/terrain]
            [terrain]
                x,y=$x2,$y2
                terrain=^Kov
                layer=overlay
            [/terrain]
        [/on_undo]
    [/event]

    #damaging aura
    [event]
        name=new turn
        first_time_only=no

        [store_unit]
            [filter]
                [filter_adjacent]
                    type=TLU_The_Last_Summoner
                    is_enemy=yes
                [/filter_adjacent]
                [not]
                    type=TLU_DharmaRashti,TLU_DharmaRashti2,TLU_Rashti,TLU_Rashti2
                [/not]
            [/filter]
            variable=harm
        [/store_unit]

        [foreach]
            array=harm
            [do]
                {VARIABLE this_item.status.slowed yes}
                {VARIABLE_OP this_item.hitpoints sub 8}
                [animate_unit]
                    flag=attack
                    [filter]
                        type=TLU_The_Last_Summoner
                    [/filter]
                    [primary_attack]
                        name=incantation of power
                    [/primary_attack]
                    hits=no
                    [facing]
                        [filter]
                            x,y=$this_item.x,$this_item.y
                        [/filter]
                    [/facing]
                [/animate_unit]
                [if]
                    [variable]
                        name=this_item.hitpoints
                        less_than_equal_to=0
                    [/variable]
                    [then]
                        [kill]
                            x,y=$this_item.x,$this_item.y
                            fire_event=yes
                            animate=yes
                        [/kill]
                    [/then]
                    [else]
                        [unstore_unit]
                            find_vacant=no
                            variable=this_item
                            text=_ "8"
                            {COLOR_HARM}
                        [/unstore_unit]
                    [/else]
                [/if]
            [/do]
        [/foreach]
        {CLEAR_VARIABLE harm}
    [/event]
    [event]
        name=side turn
        id=mehirgate_spawn_event1
        first_time_only=no

        [store_unit]
            [filter]
                type=TLU_The_Last_Summoner
                ability=tlu_spawndgs
            [/filter]
            variable=mehirgate
        [/store_unit]

        {IF_VAR side_number equals $mehirgate.side (
            [then]
                [store_locations]
                    [and]
                        x,y=$mehirgate.x,$mehirgate.y
                        radius=1
                    [/and]
                    [not]
                        [filter]
                        [/filter]
                    [/not]
                    variable=mehirgateloc
                [/store_locations]
                {IF_VAR mehirgateloc.length greater_than 0 (
                    [then]
                        [animate_unit]
                            flag=spawn_dg
                            [filter]
                                type=TLU_The_Last_Summoner
                                ability=tlu_spawndgs
                            [/filter]
                        [/animate_unit]
                        {UNIT $side_number (EoMa_Dimensional_Gate_II) $mehirgateloc.x $mehirgateloc.y (moves,attacks_left,placement,passable,animate,upkeep=0,0,map,yes,yes,loyal)}
                    [/then]
                )}
            [/then]
        )}
    [/event]
[/unit_type]
